# 环境部署 - env.sh

## 安装

项目根目录下运行 `env.sh` 即可。

```shell
$ bash env.sh
# 如果你的测试机密码不是 `1` ，那需要在全局配置文件 `globalconfig.ini` 里面将 	`PASSWORD` 配置项修改为当前测试机的密码。
```


## 定制依赖

### 1. 新增依赖

如果应用库还需要其他 `Python` 依赖库，只需要在应用库根目录下保存一个 `requirement.txt` 文件；

```shell
autotest_xxx
├── requirement.txt
├── case	
...
```

里面写入需要安装的三方依赖，比如像这样：

```shell
PyYAML==6.0  # 指定安装某个版本
requests  # 未指定版本则安装最新版
```

在执行 `bash env.sh` 时会一并将其安装。

如果多个应用库都存在 `requirement.txt` 文件，执行 `env.sh` 时会将多个 `requirement.txt` 文件一并加载；那么一定要注意多个 `requirement.txt` 文件可能存在相同的依赖被指定安装不同版本等等兼容性问题。

**【deb 形式 Python 包】**

在应用库根目录下保存一个 `requirement_deb.txt` 文件；

```shell 
autotest_xxx
├── requirement_deb.txt
├── case	
...
```

里面写入需要安装的三方依赖，比如像这样：

```
python3-pyaudio
```

### 2. 裁剪依赖

在某些情况下，可能你只需要安装一些最最基础的依赖，其他的都不需要，比如纯接口自动化的项目，它不需要 `UI` 自动化相关的依赖。

你只需要在应用库根目录下，存放一个 `BASICENV` 的普通文件，里面不需要写任何内容，这样执行 `env.sh` 时，只会安装最基础的依赖。

```shell
autotest_xxx
├── BASICENV  # 可以使用：touch BASICENV 创建文件
├── case	
...
```

基础依赖仅安装最基础的几个包；

`裁剪依赖` 和 `新增依赖` 是不冲突的，可以同时使用。

## 开发环境部署

在开发过程中，如果你想直接部署在本机上：

```shell
$ bash env.sh -D
```

 这种方式安装的环境不会有 `youqu` 这个命令，用例执行都使用 `python3` 驱动即可，比如：

```shell
$ python3 manage.py run
```

## 虚拟环境解释器

YouQu 默认采用虚拟化部署，虚拟环境实际安装的位置是在 `$HOME/.local/share/virtualenvs/youqu-oHTM7l7G` 目录下；其中，

`youqu-oHTM7l7G` 此目录名称前面部分是你的代码根目录的名称，后面部分是生成的随机字符串，同学们在部署的时候随机字符串肯定和我这里的例子不一样；

在远程机器上定位问题的时候，如果使用 `Pycharm` 调试执行，就将解释器指定到这个目录的就行了；

## 激活虚拟环境

在开发过程中有可能需要在终端激活虚拟环境，以便进行一些开发调试；

在框架根目录下命令行输入：

```shell
$ youqu-shell
```

即可在终端激活当前虚拟环境。

## 原则

`YouQu` 的环境依赖一直坚持 2 个原则：

- **最小环境依赖原则**

大多数情况下，在写一些功能，首先想到的就是去搜索看有没有现成的工具直接能用，行话叫不要重复造轮子。

但这样做有一个很严重的问题，就是当你写一个大型项目时，你会引入非常非常多的依赖。

依赖项越多，依赖关系就越复杂，后期越容易出问题，在实现一个功能的时候，首先我们应该去想自己怎么样去实现，尽量使用标准库去做。

那些嘲笑、批评我们重复造轮子的人，先想想自己会造轮子吗。

本着**自己实现能实现的一切**的原则，`YouQu` 框架做到了非常少的环境依赖，而且我们仍在不断努力，减少环境部署的依赖。

- **最小仓库体积原则**

大文件不能上传到工程里面，保持整个工程的轻量化，这样在克隆代码的时候才能非常快速方便使用，我们见过一个工程 clone 大小达到好几个 G，简直不可思议。